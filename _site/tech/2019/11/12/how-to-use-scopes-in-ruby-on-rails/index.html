<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Sử dụng scopes trong Ruby on Rails</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="Harmony is a free responsive jekyll theme by Gayan Virajith and Maheshika Lakmali. Sourced on Github - https://github.com/gayanvirajith/harmony
">
        <link rel="canonical" 
        href="http://localhost:4000/tech/2019/11/12/how-to-use-scopes-in-ruby-on-rails/">
        
        <!-- styles -->
        <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="/">A litte of Hưng</a></h1>
                <h2>Mọi thứ vẫn luôn ở đó, chỉ cần bạn đưa tay ra và nắm lấy mà thôi.</h2>
                <ul class="header-links" id="header-links">
	<li>
		<a href="http://localhost:4000/">Home</a><span>/</span>
	</li>
	<li>
		<a href="http://localhost:4000/life">Life</a><span>/</span>
	</li>
	<li>
		<a href="http://localhost:4000/tech">Tech</a><span>/</span>
	</li>
	<li>
		<a href="http://localhost:4000/about">About</a><span>/</span>
	</li>
	
</ul>                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>Sử dụng scopes trong Ruby on Rails</h1>
		<p class="post-meta">
			
      <span class="categories">
      tech
      </span> |
	    
	    <span class="post-date">
    	Nov 12, 2019 
	    </span>
		</p>		
		<div class="post">
			<p>This article found in: https://www.rubyguides.com/2019/10/scopes-in-ruby-on-rails/</p>

<p>Let’s begin!</p>

<p>What is scope in Rails &amp; why is it useful (hữu ích) ?</p>

<p>Well…</p>

<p>Scopes are custom queries (Truy vấn tùy chỉnh) that you define inside (bên trong) your Rails models with the <code>scope</code> method.</p>

<p><strong>Every scope takes two arguments:</strong></p>
<ol>
  <li>A name, which you use to call this scope in your code</li>
  <li>A lambda, which implements the query</li>
</ol>

<p>It looks like this (trông như):</p>
<pre><code>class Fruit &lt; ApplicationRecord
  scope :with_juice, -&gt; { where("juice &gt; 0") }
end
</code></pre>

<p>As a result of calling a scope, you’ll get an <code>ActiveRecord::Relation</code> object.
(Kết quả khi sử dụng <code>scope</code>, bạn sẽ nhận được một <code>ActiveRecord::Relation</code>)</p>

<p>Which means you can chain &amp; combine scopes!
(Điều đó có nghĩa rằng bạn có thể kết hợp các scope lại với nhau)</p>

<p>Example:</p>
<pre><code>Fruit.with_juice.with_round_shape.first(3)
</code></pre>

<p>Now:</p>

<p>There’s more to learn about Rails scopes, so let’s keep exploring the topic.
(Phần mở rộng)</p>

<h3 id="when-to-use-scope--khi-nào-sử-dụng-scope-">When to use scope ? (Khi nào sử dụng scope ?)</h3>
<p>Ok, scopes are cool, but when should you use them?</p>

<p>Let’s see an example.</p>
<pre><code>def index
  @books = Book.where("LENGTH(title) &gt; 20")
end
</code></pre>

<p>This is an index controller action that wants to display books with titles longer than 20 characters.
(Trong action index trên muốn hiển thị những đối tượng books mà title có độ dài &gt; 20 kí tự)</p>

<p><strong>It’s fine.</strong></p>

<p>But if you want to use this query in other places, you’re going to have duplicated code.
(Nhưng nếu bạn muốn sử dụng lại câu truy vấn trên ở nơi khác, bajnn sẽ lặp lại code)</p>

<p>Duplicated code makes your project harder to maintain.
(Lặp lại code khiến dự án của bạn khó khăn cho maintain)</p>

<p>Let’s move this query into a scope.
(Hãy di chuyển những câu truy vấn đó vào scope)</p>

<p>Like this:</p>
<pre><code>class Book
  scope :with_long_title, -&gt; { where("LENGTH(title) &gt; 20") }
end
</code></pre>

<p>Now our controller action looks like this:</p>
<pre><code>def index
  @books = Book.with_long_title
end
</code></pre>

<h3 id="how-to-use-rails-scopes-with-arguments-sử-dụng-scope-với-đối-số">How to Use Rails Scopes With Arguments (Sử dụng scope với đối số)</h3>
<p>You may want to introduce a variable into a scope so you can make it more flexible.
(Bạn có thể muốn khai báo <code>biến</code> trong scope để có thể khiến scope trở nên linh hoạt hơn)</p>

<p>Here’s how:</p>
<pre><code>class Book
  scope :with_long_title, -&gt;(length) { where("LENGTH(title) &gt; ?", length) }
end
</code></pre>
<p>The question mark (?) is a placeholder, it’ll be replaced by the value of length. This makes your code safer.
(Dấu <code>?</code> là một phần trống, nó sẽ được thay bằng giá trị của chiều dài tức biến truyền vào. Nó làm cho code trở nên an toàn hơn))</p>

<p>If you want a default value:
(Khi cần khai báo giá trị mặc định của biến truyền vào:)</p>
<pre><code>class Book
  scope :with_long_title, -&gt;(length = 20) { where("LENGTH(title) &gt; ?", length) }
end
</code></pre>
<p>Give it a try!
(Hãy thử dùng nó)</p>

<h3 id="scope-vs-instance-method-so-sánh-scope-và-hàm-instance">Scope vs Instance Method (So sánh scope và hàm instance)</h3>
<p>Scopes aren’t doing anything magical or super special.
(Scope không làm bất cứ điều gì kỳ diệu hoặc siêu đặc biệt)</p>

<p>They are just methods.
(Chúng chỉ là methods)</p>

<p>In fact… You could do the same thing using class methods!
(Bạn có thể làm tương tự bằng các sử dụng <code>class methods</code>)</p>
<pre><code>class Fruit
  def self.with_juice
    where("juice &gt; 0")
  end
end
</code></pre>

<p>But there are design advantages to using scopes over class methods.
(Nhưng có những lợi ích về mặt design để dử dụng scopes hơn là sử dụng <code>class method</code>)</p>

<p>Here’s why:</p>

<ol>
  <li>Scopes result in cleaner code because of their syntax
(Scopes trông sạch sẽ hơn vì cú pháp đơn giản của nó)</li>
  <li>Scopes are used for exactly one thing, so you know what you get the moment you see one
(Scope được sử dụng chính xác cho một mục đích, vì vậy bạn có thể biết ngay mục đích của scope đó ngay khi bạn đọc)</li>
  <li>Scopes aren’t mixed with other methods, so they’re easier to spot
(Scope không trộn lẫn với các <code>methods</code> khác, vì thế nó dễ dàng có thể được phát hiện ra trong code)</li>
</ol>

<p>In terms of functionality, the only difference is that scopes guarantee an ActiveRecord::Relation, and class methods don’t.
(Về mặt chức năng, điều khác biệt duy nhất mà scope bảo đảm đó chính là trả về một <code>ActiveRecord::Relation</code> mà <code>class methods</code> thì không.)</p>

<p>This helps you avoid errors when your scope returns nothing.
(Điều đó giuos tránh được lỗi khi <code>scope</code> không trả về  kết quả)</p>

<h3 id="dont-use-default-scopes-không-sử-dụng-default-scope">Don’t Use Default Scopes (Không sử dụng default scope)</h3>
<p>A default scope is one which is automatically applied to your model.
(Default scope là scope luôn được áp dụng cho model khi khởi tạo)</p>

<p>Example:</p>
<pre><code>class Post
  default_scope { where(published: true) }
end
</code></pre>

<p>Default scopes are so attractive(hấp dẫn).
But they’re often the wrong choice (Lựa chọn sai) because you’ll probably forget (có thể quên) you have them defined, run into strange errors (chạy vào những lỗi lạ), and waste precious time (lãng phí thời gian quý báu) debugging.</p>

<p><strong>With that said…</strong> (Khắc phục khi sử dụng default scope)
If you have to work with default scopes, you may need to use the unscoped method to disable all currently applied scopes.</p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h4>
		<ul class="posts">
		    
		    <li>
			  <span>09 Jun 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/06/09/10-errors-when-build-api-and-how-to-fix-them/">10 Error status codes khi xây dựng API và cách giải quyết chúng</a>
		    </li>
		    
		    <li>
			  <span>09 Jun 2020 &raquo;</span>
			  <a href="http://localhost:4000/life/2020/06/09/keep/">Bản thân bạn đang ở đâu ?</a>
		    </li>
		    
		    <li>
			  <span>27 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/2020/05/27/rails-map-vs-pluck/">Rails Map Vs Pluck</a>
		    </li>
		    
		    <li>
			  <span>27 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/2020/05/27/chuan-hoa-csdl/">Chuan Hoa Csdl</a>
		    </li>
		    
		    <li>
			  <span>08 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/05/08/rails-rails-ckeditor-mention-with-elaticsearch/">Rails cucumber - capybara notes</a>
		    </li>
		    
		    <li>
			  <span>08 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/05/08/rails-elaticsearch-1-introduction/">Rails elaticsearch - 1.Introduction</a>
		    </li>
		    
		    <li>
			  <span>08 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/05/08/rails-cucumber-capybara-notes/">Test behavior với cucumber và capybara</a>
		    </li>
		    
		    <li>
			  <span>08 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/05/08/dung-bao-gio-git-push-f/">Đừng bao giờ `git push -f`</a>
		    </li>
		    
		    <li>
			  <span>08 May 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/05/08/rails-rspec-notes/">Rails rspec notes</a>
		    </li>
		    
		    <li>
			  <span>08 Mar 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/03/08/form_with-vs-form_tag/">form_with — Building HTML forms in Rails 5.1</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="http://localhost:4000/tech/2019/09/09/ruby-inject-vs-each_with_object/"><< Older</a>
			
		</div>
		<div class="column-2"><a href="http://localhost:4000/ ">Home</a></div>
		<div class="column-3">
			
				<a href="http://localhost:4000/tech/2019/11/12/rails-6-active-storage-changes/">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="http://localhost:4000/about">About</a></li>
    <li><a href="http://localhost:4000/life">Life</a></li>
    <li><a href="http://localhost:4000/tech">Tech</a></li>
    <li><a href="http://localhost:4000/faq">Help / FAQ</a></li>    
</ul>		                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="hungnv950 on Twitter" 
            href="https://twitter.com/hungnv950" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="hungnv950 on Github" 
            href="https://github.com/hungnv950" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="hungnv950 on Facebook" 
            href="https://facebook.com/hungnv950" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    
    <li>
        <a title="+hungnv950 on Google Plus" 
            href="https://plus.google.com/+hungnv950" 
            class="google wc-img-replace" target="_blank">Google</a>
    </li>
    

    
    <li>
        <a title="gayan on Dribble" 
            href="https://dribbble.com/gayan" 
            class="dribble wc-img-replace" target="_blank">Dribble</a>
    </li> 
    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
	Made by <a href="http://gayan.me" target="_blank">Gayan Virajith</a> For everyone.      

Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'http://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="/assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
    </body>        
</html>
