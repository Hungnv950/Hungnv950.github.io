<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Block và yield trong ruby</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">        
        <meta name="description" content="Harmony is a free responsive jekyll theme by Gayan Virajith and Maheshika Lakmali. Sourced on Github -  https://github.com/gayanvirajith/harmony
">
        <link rel="canonical" 
        href="http://localhost:4000/tech/2018/03/21/ruby-block-and-yield/">
        
        <!-- styles -->
        <link rel="stylesheet" type="text/css" href="/assets/css/main.css">

        <!-- Modernizr js -->
        <script async src="/assets/js/modernizr.js"></script>    

        <!-- IE Fixes -->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->        
    </head>
    <body class="theme-base-01">
        <header class="main-header">
            <div class="wc-container">
                <h1><a href="/">Lang thang</a></h1>
                <h2>A litte of Hưng.</h2>
                <ul class="header-links" id="header-links">
	<li>
		<a href="http://localhost:4000/">Home</a><span>/</span>
	</li>
	<li>
		<a href="http://localhost:4000/life">Life</a><span>/</span>
	</li>
	<li>
		<a href="http://localhost:4000/tech">Tech</a><span>/</span>
	</li>
	<li>
		<a href="http://localhost:4000/about">About</a><span>/</span>
	</li>
	
</ul>                
            </div>
        </header>
        <div class="page-content wc-container">
	
	<div class="post">
		<h1>Block và yield trong ruby</h1>
		<p class="post-meta">
			
      <span class="categories">
      tech
      </span> |
	    
	    <span class="post-date">
    	Mar 21, 2018 
	    </span>
		</p>		
		<div class="post">
			<h1 id="blocks"><strong><code>Blocks</code></strong></h1>
<p>Về cơ bản, <code>blocks</code> trong ruby là một cách để nhóm các câu lệnh sao cho chúng ta có thể kết hợp với các lời gọi phương thức như thể chúng là các tham số.</p>

<p>Ruby cung cấp hai cách để viết <code>blocks</code> là:</p>
<ol>
  <li>Sử dụng dấu <code>{}</code> đối với những blocks ngắn gọn có thể viêt trên một dòng.
    <pre><code>array = [1,2,3,4]
</code></pre>
  </li>
  <li>Sử dụng cụm <code>do..end</code>
    <pre><code>array.map! do |n|
  n * n
end
=&gt; [1, 4, 9, 16]
</code></pre>
  </li>
</ol>

<h2 id="procs"><strong><code>Procs</code></strong></h2>
<p>Một proc là một instance của lớp Proc. Proc là <code>object</code> còn <code>blocks</code> thì không.</p>
<pre><code>p = Proc.new { puts "Hello World" }
</code></pre>
<p>Điều này cho phép chúng ta gọi các phương thức trên nó và gán nó cho các biến. Procs cũng có thể gọi lại chính nó.</p>
<pre><code>p.call  # prints 'Hello World'
p.class # returns 'Proc'
a = p   # a now equals p, a Proc instance
p       # returns a proc object '#&lt;Proc:0x007f96b1a60eb0@(irb):46&gt;'
</code></pre>
<h2 id="-lambdas"><code> Lambdas</code></h2>
<p>Lambda function hầu như giống với Procs nhưng có hai điểm khác biệt:</p>
<ul>
  <li>Thứ nhất: Lambda kiểm tra số lượng phần tử đầu vào. Báo lỗi nếu không chính xác. Còn Procs thì không
    <pre><code>l = lambda { "I'm a lambda" }
l.call
=&gt; "I'm a lambda"
l.call('arg')
ArgumentError: wrong number of arguments (1 for 0)
</code></pre>
  </li>
  <li>Thứ hai:  Lambdas và Procs xử lý khi gặp từ khóa <code>return</code> khác nhau:</li>
</ul>

<pre><code>def lambda_test
  lam = lambda { return }
  lam.call
  puts "Hello world"
end

lambda_test                 # calling lambda_test prints 'Hello World'
</code></pre>
<pre><code>def proc_test
  proc = Proc.new { return }
  proc.call
  puts "Hello world"
end

proc_test                 # calling proc_test prints nothing
</code></pre>
<h1 id="yield"><strong><code>Yield</code></strong></h1>
<p>Yield là một cách rất hay của Ruby để thực hiện một khối trong một phương thức bất kì mà không làm ảnh hưởng. Để hiểu rõ hơn chúng ta cùng theo dõi một ví dụ:</p>
<pre><code>def rb_block
  puts 'Start'
  yield
  yield
  puts 'End'
end

rb_block {puts "We're in the block"}
</code></pre>
<p><code>Kết quả:</code></p>
<pre><code>Start
We're in the block
We're in the block
End
</code></pre>
<p>Dễ hiểu, khi thực thi method <code>rb_block</code>, ruby thực hiện câu bình thường cho tới khi gặp từ khóa <code>yield</code> , ruby sẽ dừng và thực hiện block này sau đó sẽ thực thi tiếp tục các logic của method <code>rb_block</code></p>
<h2 id="yield-với-tham-số">Yield với tham số</h2>
<p>Để dễ hiểu, ta quan sát ví dụ:</p>
<pre><code>def rb_block
    yield('hello', 'ruby')
end

rb_block { |s, r| puts s + ' ' + r
</code></pre>
<p><code>Kết quả:</code></p>
<pre><code>hello ruby
</code></pre>
<p>Ta thấy, ruby cho phép truyển tham số vào yield trong các khối. Trong khối, chúng ta liệt kê tên của các đối số để nhận các tham số qua các dấu <code>||</code></p>

<p><code>Lưu ý:</code> Khi định nghĩa <code>yield</code> <code>có tham số</code>, việc truyền vào tham số bắt buộc. Nếu không nhận được tham số phù hợp ruby sẽ báo lỗi.</p>
<pre><code>rb_block   #`rb_block': no block given (yield) (LocalJumpError)
</code></pre>
<h1 id="tài-liệu-tham-khảo">Tài liệu tham khảo</h1>
<p>http://www.bogotobogo.com/RubyOnRails/RubyOnRails_Blocks_and_Yield.php</p>

<p>https://code.tutsplus.com/tutorials/ruby-on-rails-study-guide-blocks-procs-and-lambdas–net-29811</p>

<p>http://awaxman11.github.io/blog/2013/08/05/what-is-the-difference-between-a-block/</p>

<p>https://viblo.asia/p/thanh-thao-ruby-block-trong-5-phut-L4x5xg2alBM/</p>

<p>https://viblo.asia/p/block-trong-ruby-wjAM7yNOvmWe</p>

		</div>
	</div>


	
	<div class="related">
		<h4>Related Posts</h4>
		<ul class="posts">
		    
		    <li>
			  <span>08 Mar 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/03/08/form_with-vs-form_tag/">form_with — Building HTML forms in Rails 5.1</a>
		    </li>
		    
		    <li>
			  <span>26 Feb 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/02/26/clean-code-comment/">Clean code - Comment</a>
		    </li>
		    
		    <li>
			  <span>25 Feb 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/02/25/clean-code-function/">Clean code - function</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2020 &raquo;</span>
			  <a href="http://localhost:4000/post/2020/02/24/gem-sidekiq/">Ruby gem - Sidekiq</a>
		    </li>
		    
		    <li>
			  <span>24 Feb 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/02/24/ruby-notes/">Ruby Notes</a>
		    </li>
		    
		    <li>
			  <span>06 Jan 2020 &raquo;</span>
			  <a href="http://localhost:4000/life/2020/01/06/the-x-y-problem/">The X-Y problem</a>
		    </li>
		    
		    <li>
			  <span>06 Jan 2020 &raquo;</span>
			  <a href="http://localhost:4000/tech/2020/01/06/login-and-messaging-with-line/">Ruby - Login and messaging with line</a>
		    </li>
		    
		    <li>
			  <span>22 Dec 2019 &raquo;</span>
			  <a href="http://localhost:4000/tech/2019/12/22/rails-namespace-vs-scopes/">Rails routes namespace vs scopes</a>
		    </li>
		    
		    <li>
			  <span>22 Dec 2019 &raquo;</span>
			  <a href="http://localhost:4000/tech/2019/12/22/tat-tan-tat-ve-array-trong-ruby/">Tất tần tật về array trong ruby</a>
		    </li>
		    
		    <li>
			  <span>14 Dec 2019 &raquo;</span>
			  <a href="http://localhost:4000/2019/12/14/select-multy-categories/">Select muli categories with rails + jquery</a>
		    </li>
		    
		</ul>
	</div>
	

	<div class="post-footer">
		<div class="column-1">
			
				<a href="http://localhost:4000/tech/2018/03/21/git-cherry-pick/"><< Older</a>
			
		</div>
		<div class="column-2"><a href="http://localhost:4000/ ">Home</a></div>
		<div class="column-3">
			
				<a href="http://localhost:4000/life/2019/06/26/morning-speech-cha-da-quen/">Newer >></a>
			
		</div>
	</div>
</div>
 

        <footer class="main-footer">
            <div class="wc-container">
                <div class="column one">
                    <h6>Few more links</h6>
<ul class="menu">
    <li><a href="http://localhost:4000/about">About</a></li>
    <li><a href="http://localhost:4000/life">Life</a></li>
    <li><a href="http://localhost:4000/tech">Tech</a></li>
    <li><a href="http://localhost:4000/faq">Help / FAQ</a></li>    
</ul>		                    
                </div>
                <div class="column two">
                    <h6>Follow me</h6>

<ul class="social-media">


    
    <li>
        <a title="hungnv950 on Twitter" 
            href="https://twitter.com/hungnv950" 
            class="twitter wc-img-replace" target="_blank">Twitter</a>
    </li>   
    

    
    <li>
        <a title="hungnv950 on Github" 
            href="https://github.com/hungnv950" 
            class="github wc-img-replace" target="_blank">Github</a>
    </li>
     

    
    <li>
        <a title="hungnv950 on Facebook" 
            href="https://facebook.com/hungnv950" 
            class="facebook wc-img-replace" target="_blank">Facebook</a>
    </li>
    

    
    <li>
        <a title="+hungnv950 on Google Plus" 
            href="https://plus.google.com/+hungnv950" 
            class="google wc-img-replace" target="_blank">Google</a>
    </li>
    

    
    <li>
        <a title="gayan on Dribble" 
            href="https://dribbble.com/gayan" 
            class="dribble wc-img-replace" target="_blank">Dribble</a>
    </li> 
    

    

</ul>
                </div>
            </div>
            <p class="wc-container disclaimer">
                
	Made by <a href="http://gayan.me" target="_blank">Gayan Virajith</a> For everyone.      

Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>
            </p>
        </footer>
        <script type="text/javascript">
          /* To avoid render blocking css */
          var cb = function() {
            var l = document.createElement('link'); l.rel = 'stylesheet';
            l.href = 'http://fonts.googleapis.com/css?family=Ubuntu+Mono&subset=latin';
            var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
          };
          var raf = requestAnimationFrame || mozRequestAnimationFrame ||
              webkitRequestAnimationFrame || msRequestAnimationFrame;
          if (raf) raf(cb);
          else window.addEventListener('load', cb);
        </script>
        <!-- jQuery -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
        <!-- When no internet load JQuery from local -->
        <script>window.jQuery || document.write('<script src="/assets/js/jquery.min.js"><\/script>')</script>
        <!-- Site js -->
        <script src="/assets/js/all.js"></script>
        <!-- Google analytics  -->
        
    </body>        
</html>
