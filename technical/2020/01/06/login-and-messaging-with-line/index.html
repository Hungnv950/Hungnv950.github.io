<!DOCTYPE html> <html lang=" en "><head> <meta charset="utf-8" /> <title> Ruby - Login and messaging with line -Hungnv950 </title> <meta http-equip="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <meta name="keywords" content="Ruby - Login and messaging with line, Hungnv950, technical,"/> <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" /> <meta content="" property="fb:app_id" /> <meta content="Hungnv950" property="og:site_name" /> <meta content="Ruby - Login and messaging with line" property="og:title" /> <meta content="article" property="og:type" /> <meta content="Hi I a Hung Nguyen, a Web Developer and Project Manager" property="og:description" /> <meta content="/technical/2020/01/06/login-and-messaging-with-line/" property="og:url" /> <meta content="2020-01-06T00:00:00+00:00" property="article:published_time" /> <meta content="/about/" property="article:author" /> <meta content="/assets/img/posts/messaging-api-architecture.f40bffbb.png" property="og:image" /> <meta content="technical" property="article:section" /> <!-- Twitter Cards --> <meta name="twitter:card" content="summary" /> <meta name="twitter:site" content="@" /> <meta name="twitter:creator" content="@" /> <meta name="twitter:title" content="Ruby - Login and messaging with line" /> <meta name="twitter:url" content="/technical/2020/01/06/login-and-messaging-with-line/" /> <meta name="twitter:description" content="Hi I a Hung Nguyen, a Web Developer and Project Manager" /> <link rel="stylesheet" href="/assets/css/main.css" /> <!-- <link rel="stylesheet" href="/assets/css/custom-style.css" /> --> <link rel="stylesheet" href="/assets/bower_components/lightgallery/dist/css/lightgallery.min.css" /> <link rel="stylesheet" href="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.css" /> <link rel="stylesheet" href="/assets/bower_components/bootstrap/dist/css/bootstrap.min.css" /> <link rel="stylesheet" href="/assets/bower_components/font-awesome/web-fonts-with-css/css/fontawesome-all.min.css" /> <link rel="stylesheet" href="/assets/bower_components/icono/dist/icono.min.css" /> <!-- Fonts--> <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet" /> <!-- Favicon --> <link rel="icon" href="/assets/img/favicon.ico" type="image/gif" sizes="16x16" /> <script> var base_url = '' ; </script> <!-- Jquery --> <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha384-vk5WoKIaW/vJyUAd9n/wmopsmNhiy+L2Z+SBxGYnUkunIxVxAv/UtMOhba/xskxh" crossorigin="anonymous" ></script> <!-- <script src="/assets/bower_components/jquery/dist/jquery.min.js"></script> --> <script src="/assets/bower_components/jquery.easing/jquery.easing.min.js"></script> <script src="/assets/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script> <script src="/assets/bower_components/jquery-mousewheel/jquery.mousewheel.min.js"></script> <script src="/assets/bower_components/ghosthunter/dist/jquery.ghostHunter.min.js"></script> <script src="/assets/bower_components/lightgallery/dist/js/lightgallery-all.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/picturefill/3.0.2/picturefill.min.js"></script> <script src="/assets/bower_components/imagesloaded/imagesloaded.pkgd.min.js"></script> <script src="/assets/bower_components/nanobar/nanobar.min.js"></script> <script src="/assets/bower_components/typewrite/dist/typewrite.min.js"></script> <script src="/assets/js/search.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script> <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script> <!-- for Mathjax support --> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "AMS" } } }); </script> <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> <!-- Github Button --> <script async defer src="https://buttons.github.io/buttons.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous" ></script> <!-- (you can remove the below scripts but do buy me a coffee to show some support :) --> <!-- Maker widget --> <!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if IE 7]> <html class="no-js lt-ie9 lt-ie8"> <![endif]--> <!--[if IE 8]> <html class="no-js lt-ie9"> <![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]--> </head> <body> <nav class="navbar navbar-expand-lg fixed-top navbar-dark" id="topNav"> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation" > <span class="icono-hamburger" id="navbar-hamburger"> </span> </button> <a class="navbar-brand" href="/">Hungnv950</a> <div class="collapse navbar-collapse" id="navbarNav"> <ul class="navbar-nav"> <li class="nav-item"> <a class="nav-link" href="/" >Home</a > </li> <li class="nav-item"> <a class="nav-link" href="/blog" >Blog</a > </li> <li class="nav-item"> <a class="nav-link" href="/gallery" >Gallery</a > </li> <li class="nav-item"> <a class="nav-link" href="/about" >About</a > </li> <li class="nav-item"> <a class="nav-link" href="/contact" >Contact</a > </li> </ul> </div> <ul class="nav justify-content-end"> <li class="nav-item"> <a class="nav-link toggle-search-button" href="#search"> <i class="fa fa-search search-icon" aria-hidden="true"></i> </a> </li> <!-- <li class="nav-item" style="margin-top:5px; padding-right:20px;" > <a class="header__checkout snipcart-checkout"> <svg width="31" height="27" viewBox="0 0 31 27" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M1.10512 0.368718C0.560256 0.368718 0.118164 0.812066 0.118164 1.35848C0.118164 1.9049 0.560256 2.34824 1.10512 2.34824H4.90887L8.30138 18.4009C8.43503 19.0053 8.83085 19.5079 9.32946 19.5041H25.7788C26.3005 19.5118 26.7799 19.0375 26.7799 18.5143C26.7799 17.9911 26.3006 17.5168 25.7788 17.5245H10.1315L9.71003 15.545H27.095C27.5371 15.5412 27.9547 15.2048 28.0511 14.7718L30.354 4.87412C30.4825 4.29933 29.9852 3.67172 29.3979 3.66786H7.21171L6.6771 1.15221C6.58329 0.71276 6.15921 0.368652 5.7107 0.368652L1.10512 0.368718ZM7.623 5.64746H12.7634L13.2569 8.61674H8.25005L7.623 5.64746ZM14.7785 5.64746H20.9881L20.4946 8.61674H15.2719L14.7785 5.64746ZM23.0031 5.64746H28.1537L27.4649 8.61674H22.5097L23.0031 5.64746ZM8.67181 10.5963H13.5862L14.0797 13.5656H9.29919L8.67181 10.5963ZM15.6009 10.5963H20.1656L19.6721 13.5656H16.0944L15.6009 10.5963ZM22.1807 10.5963H27.0023L26.3135 13.5656H21.6872L22.1807 10.5963ZM12.6197 20.164C10.8141 20.164 9.32979 21.6525 9.32979 23.4632C9.32979 25.2739 10.8141 26.7624 12.6197 26.7624C14.4252 26.7624 15.9095 25.2739 15.9095 23.4632C15.9095 21.6525 14.4252 20.164 12.6197 20.164ZM22.4892 20.164C20.6837 20.164 19.1994 21.6525 19.1994 23.4632C19.1994 25.2739 20.6837 26.7624 22.4892 26.7624C24.2948 26.7624 25.7791 25.2739 25.7791 23.4632C25.7791 21.6525 24.2948 20.164 22.4892 20.164ZM12.6197 22.1435C13.3586 22.1435 13.9356 22.7222 13.9356 23.4632C13.9356 24.2042 13.3586 24.7829 12.6197 24.7829C11.8807 24.7829 11.3037 24.2042 11.3037 23.4632C11.3037 22.7222 11.8807 22.1435 12.6197 22.1435ZM22.4892 22.1435C23.2282 22.1435 23.8052 22.7222 23.8052 23.4632C23.8052 24.2042 23.2282 24.7829 22.4892 24.7829C21.7503 24.7829 21.1733 24.2042 21.1733 23.4632C21.1733 22.7222 21.7503 22.1435 22.4892 22.1435Z" fill="#ff7901" class="header__checkout-fill"></path> </svg> <span class="snipcart-items-count"></span> <span class="snipcart-total-price"></span> </a> </li> --> <li class="nav-item"> <input class="nav-link switch" id="theme-toggle" onclick="modeSwitcher() " type="checkbox" name="checkbox" /> </li> </ul> </nav> <!-- Search Form --> <div class="search-form-container"> <form class="search-form"> <fieldset class="search-form__fieldset"> <div class="row"> <div class="col-lg-8 offset-md-2"> <input class="search-form__field" placeholder="Type to Search..." autofocus> <input class="search-form__submit" type="submit" value="search"> </div> </div> </fieldset> </form> <div class="row"> <div class="col-lg-8 offset-md-2 search-results"> <div class="card search-results"></div> </div> </div> <div class="close-search-button search-form-container__close"> <i class="fa fa-times icon"></i> </div> </div> <div class="col-lg-12"> <div class="row" id="blog-post-container"> <div class="col-lg-8 offset-md-2"><article class="card" itemscope itemtype="http://schema.org/BlogPosting"> <div class="card-header"> <h1 class="post-title" itemprop="name headline">Ruby - Login and messaging with line</h1> <h4 class="post-meta"></h4> <p class="post-summary"> Posted by : <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name"><a href="/blog/authors/hungnv950">hungnv950</a></span> </span > at <time datetime="2020-01-06 00:00:00 +0000" itemprop="datePublished" >Jan 6, 2020</time > </p> <span class="disqus-comment-count" data-disqus-identifier="/technical/2020/01/06/login-and-messaging-with-line/" ></span> <div class="post-categories"> Category : <a href="/blog/categories/technical" >Technical</a > </div> </div> <div class="card-body" itemprop="articleBody"> <img class="card-img-top" src="/assets/img/posts/messaging-api-architecture.f40bffbb.png" alt="" /> <br /> <br /> <blockquote> <p>Gần đây mình có gặp lại task liên quan tới việc implement tính năng đăng nhập và nhắn tin thông qua mạng xã hội Line.</p> </blockquote> <blockquote> </blockquote> <blockquote> <p>Tuy cách đây 1 năm mình cũng đã gặp task này nhưng khi gặp lại cũng còn khá nhiều bỡ ngỡ nên mình quyết định xây 1 chiếc base nhỏ cùng những <code class="language-plaintext highlighter-rouge">noob</code> của mình để biết đâu sau này mình hoặc bạn có thể tránh phải</p> </blockquote> <h3 id="1-đặt-vấn-đề">1. Đặt vấn đề</h3> <p>Để làm bất cứ task nào mà mình chưa biết thì việc tự <code class="language-plaintext highlighter-rouge">research</code> là vô cùng quan trọng. Như thường lệ, các câu hỏi đặt ra là: <code class="language-plaintext highlighter-rouge">what</code>, <code class="language-plaintext highlighter-rouge">why</code>, <code class="language-plaintext highlighter-rouge">when</code>, <code class="language-plaintext highlighter-rouge">where</code> và <code class="language-plaintext highlighter-rouge">how</code>. Và chúng ta sẽ trả lời câu hỏi đó</p> <ul> <li> <p>what ? Chúng ta sẽ thực hiện chức năng login bằng Line và nhắn tin cho người dùng sử dụng Line</p> </li> <li> <p>why ? Do có nhu cầu từ KH hoặc là vì <code class="language-plaintext highlighter-rouge">mình thích</code> =))</p> </li> <li> <p>when ? Khi người dùng muốn đồng bộ hoặc sử dụng thông tin tài khoản cá nhân Line của mình với hệ thống mà không tốn thời gian đăng nhập + nhận thông báo của hệ thống thông qua line. Để sâu hơn, bạn có thể tìm hiểu về <a href="https://oauth.net/2/">OAuth-2</a></p> </li> <li> <p>where ? Phần này mình nghĩ sẽ liên quan tới <code class="language-plaintext highlighter-rouge">how</code> nhiều hơn nhưng không sao, chúng ta vẫn có thể tìm kiếm mọi thứ thông qua internet hoặc thông qua <em><code class="language-plaintext highlighter-rouge">người thân</code></em></p> </li> <li> <p>how ?</p> <ul> <li> <p>Xác định vấn đề: Các bước trên đã có vẻ clear :D</p> </li> <li> <p>Giải quyết vấn đề: Để giải quyết được các vấn đề, với mình thì nên đặt ra các câu hỏi đúng để có thể trả lời từng câu hỏi đó dẫn tới việc giải quyết bài toán. Bạn có thể tham khảo <a href="/life/2020/01/06/the-x-y-problem/" target="_blank">X-Y problem</a></p> </li> <li> <p>Khi một service sinh ra để cung cấp tính năng thì chắc chắn nhà cung cấp phải cung cấp đi kèm service đó một document cụ thể. =&gt; Tài liệu nên tìm hiểu và đọc của Line service</p> </li> </ul> </li> </ul> <h3 id="2-giải-quyết-vấn-đề">2. Giải quyết vấn đề</h3> <h4 id="21-đăng-nhập-với-tài-khoản-sử-dụng-thông-tin-đăng-nhập-từ-tài-khoản-line">2.1. Đăng nhập với tài khoản sử dụng thông tin đăng nhập từ tài khoản Line</h4> <p>Document hướng dẫn của Line: [Integrating LINE Login with your web app</p> <p>](https://developers.line.biz/en/docs/line-login/web/integrate-line-login/)</p> <p>Quá trình Đăng nhập LINE cho web (đăng nhập web) dựa trên luồng cấp mã ủy quyền OAuth 2.0 và giao thức OpenID Connect. Ứng dụng của bạn phải có khả năng thực hiện yêu cầu phía máy chủ và nhận dữ liệu từ Nền tảng LINE. Sau đây là tổng quan về dòng đăng nhập web:</p> <p><img src="https://images.viblo.asia/18f9795d-8ce2-4550-8be5-ebca1f98b7fd.png" alt="" /></p> <p>Flow đăng nhập web sử dụng Line:</p> <ol> <li> <p>Ứng dụng của bạn hướng người dùng đến URL ủy quyền Đăng nhập LINE với các tham số truy vấn bắt buộc (tham khảo bên dưới).</p> </li> <li> <p>Hộp thoại Đăng nhập LINE được mở trong trình duyệt và người dùng đăng nhập để được xác thực. Sau khi Nền tảng LINE xác thực thông tin đăng nhập của người dùng, người dùng cũng phải đồng ý cấp các quyền được yêu cầu cho ứng dụng của bạn.</p> </li> <li> <p>Nền tảng LINE chuyển hướng người dùng quay lại ứng dụng của bạn thông qua redirect_uri với mã ủy quyền và trạng thái trong chuỗi truy vấn.</p> </li> <li> <p>Ứng dụng của bạn yêu cầu mã thông báo truy cập từ https://api.line.me/oauth2/v2.1/token endpoint với mã ủy quyền.</p> </li> <li> <p>Nền tảng LINE xác nhận yêu cầu của ứng dụng của bạn và trả về mã thông báo truy cập.</p> </li> <li> <p>Khi bạn đã truy xuất mã thông báo truy cập, bạn có thể sử dụng mã này để gọi API đến các thông tin cần thiế để sử dụng.</p> </li> </ol> <p><strong>Trước khi bắt đầu bạn cần đăng kí tài khoản line channel của bạn: tại <a href="https://developers.line.biz/en/docs/line-login/getting-started/">https://developers.line.biz/en/docs/line-login/getting-started/</a></strong></p> <ul> <li>Lưu ý: trong phần <code class="language-plaintext highlighter-rouge">Callback URL</code> bạn cần khai báo địa url trong project của bạn mà sau khi line validate thành công sẽ redirect về project kèm theo params của Line cung cấp. Ví dụ trong môi trường development: http://localhost:3000/auth/line/callback</li> </ul> <p><img src="https://developers.line.biz/media/line-login/integrate-login-web/redirect-settings-cd7e32a6.png" alt="image-callback " /></p> <ul> <li>Tạo request url: <ul> <li>Để xác thực người dùng và yêu cầu quyền của ứng dụng của bạn, hãy chuyển hướng người dùng đến URL ủy quyền sau với các tham số truy vấn bắt buộc. Bạn có thể chuyển hướng người dùng bằng nút <a href="https://developers.line.biz/en/docs/line-login/login-button/">Đăng nhập LINE</a> hoặc bằng liên kết trực tiếp.</li> <li> <p>Các tham số cần thiết trong url được generate ra:</p> <table> <thead> <tr> <th>Tham số</th> <th style="text-align: center">Kiểu dữ liệu</th> <th style="text-align: right">Bắt buộc</th> <th style="text-align: right">Mô tả</th> </tr> </thead> <tbody> <tr> <td>response_type</td> <td style="text-align: center">String</td> <td style="text-align: right">Bắt buộc</td> <td style="text-align: right"><code class="language-plaintext highlighter-rouge">code</code>. Tham số này để thông báo cho Line Platform biết được cần trả về <code class="language-plaintext highlighter-rouge">authoration code</code></td> </tr> <tr> <td>client_id</td> <td style="text-align: center">String</td> <td style="text-align: right">Bắt buộc</td> <td style="text-align: right"><code class="language-plaintext highlighter-rouge">Channel ID</code>. Định danh duy nhất mà Line cung cấp cho channel của bạn, tham số này đuợc cung cấp trong trang quản lý login channel.</td> </tr> <tr> <td>redirect_uri</td> <td style="text-align: center">String</td> <td style="text-align: right">Bắt buộc</td> <td style="text-align: right"><code class="language-plaintext highlighter-rouge">Callback URL</code>. Là <code class="language-plaintext highlighter-rouge">url</code> bạn cung cấp trong setting của line channel như đã <code class="language-plaintext highlighter-rouge">chu ý ở trên</code></td> </tr> <tr> <td>state</td> <td style="text-align: center">String</td> <td style="text-align: right">Bắt buộc</td> <td style="text-align: right">Một chuỗi ký tự chữ và số duy nhất được sử dụng để ngăn chặn giả mạo yêu cầu giữa các trang web. Giá trị này sẽ được tạo ngẫu nhiên bởi ứng dụng của bạn. Không thể là một chuỗi được mã hóa URL.</td> </tr> <tr> <td>scope</td> <td style="text-align: center">String</td> <td style="text-align: right">Bắt buộc</td> <td style="text-align: right">Quyền được cấp bởi người dùng. Bạn có thể chỉ định nhiều phạm vi bằng ký tự khoảng trắng được mã hóa URL (% 20). Thông thường, scope bao gồm: profile, openid và email</td> </tr> <tr> <td>nonce</td> <td style="text-align: center">String</td> <td style="text-align: right">Không bắt buộc</td> <td style="text-align: right">Một chuỗi được sử dụng để ngăn chặn các cuộc tấn công phát lại. Giá trị này được trả về trong mã thông báo ID.</td> </tr> <tr> <td>prompt</td> <td style="text-align: center">String</td> <td style="text-align: right">Không bắt buộc</td> <td style="text-align: right"><code class="language-plaintext highlighter-rouge">consent</code>. Được sử dụng để buộc màn hình chấp thuận được hiển thị ngay cả khi người dùng đã cấp tất cả các quyền được yêu cầu.</td> </tr> <tr> <td>max_age</td> <td style="text-align: center">Number</td> <td style="text-align: right">Không bắt buộc</td> <td style="text-align: right">Thời gian cho phép trôi qua tính bằng giây kể từ lần cuối cùng người dùng được xác thực. Tương ứng với tham số max_age được xác định trong phần “Yêu cầu xác thực” của OpenID Connect Core 1.0.</td> </tr> <tr> <td>ui_locales</td> <td style="text-align: center">String</td> <td style="text-align: right">Optional</td> <td style="text-align: right">Ngôn ngữ hiển thị cho màn hình Đăng nhập LINE. Chỉ định là một hoặc nhiều thẻ ngôn ngữ RFC 5646 (BCP 47), được phân tách bằng dấu cách, theo thứ tự ưu tiên. Tương ứng với tham số ui_locales được xác định trong phần “Yêu cầu xác thực” của OpenID Connect Core 1.0.</td> </tr> <tr> <td>bot_prompt</td> <td style="text-align: center">String</td> <td style="text-align: right">Không bắt buộc</td> <td style="text-align: right">Hiển thị tùy chọn để thêm tài khoản chính thức LINE làm bạn bè trong khi đăng nhập. Đặt giá trị <code class="language-plaintext highlighter-rouge">normal</code> thường hoặc <code class="language-plaintext highlighter-rouge">aggressive</code>. Để biết thêm thông tin, hãy xem <a href="https://developers.line.biz/en/docs/line-login/web/link-a-bot/">Liên kết tài khoản chính thức LINE với kênh Đăng nhập LINE của bạn.</a></td> </tr> </tbody> </table> </li> </ul> </li> <li> <p>Sau khi tạo reques url thành công, khi di chuyển vào link đã được tạo ra, người dùng sẽ đuợc di chuyển sang trang của Line để tiến hành đăng nhập và xác thực. Nếu xác thực thành công, Line Platform sẽ redirect tới server của bạn với confir callback đã khai báo từ trước kèm them tham số là <code class="language-plaintext highlighter-rouge">code</code>, <code class="language-plaintext highlighter-rouge">state</code> và <code class="language-plaintext highlighter-rouge">friendship_status_changed</code></p> <table> <thead> <tr> <th>Tables</th> <th style="text-align: center">Are</th> <th style="text-align: right">Cool</th> </tr> </thead> <tbody> <tr> <td>code</td> <td style="text-align: center">String</td> <td style="text-align: right">Mã ủy quyền được sử dụng để nhận mã thông báo truy cập. Có giá trị trong <code class="language-plaintext highlighter-rouge">10 phút</code>. Mã ủy quyền này chỉ có thể được sử dụng một lần.</td> </tr> <tr> <td>state</td> <td style="text-align: center">String</td> <td style="text-align: right">tham số <code class="language-plaintext highlighter-rouge">state</code> được bao gồm trong URL ủy quyền của yêu cầu ban đầu. Ứng dụng của bạn nên xác minh rằng giá trị này khớp với giá trị trong yêu cầu ban đầu.</td> </tr> <tr> <td>friendship_status_changed</td> <td style="text-align: center">Boolean</td> <td style="text-align: right"><code class="language-plaintext highlighter-rouge">true</code> nếu trạng thái tình bạn giữa người dùng và tài khoản chính thức LINE thay đổi trong quá trình đăng nhập. Nếu không, <code class="language-plaintext highlighter-rouge">false</code>. Giá trị này chỉ được trả về nếu tham số truy vấn bot_prompt được chỉ định trong yêu cầu cấp phép và màn hình chấp thuận với tùy chọn thêm tài khoản chính thức LINE của bạn khi bạn bè được hiển thị cho người dùng.</td> </tr> </tbody> </table> </li> </ul> <p>Ví dụ về một response của Line trả về:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 302 Found
Location : https://client.example.org/cb?code=abcd1234&amp;state=0987poi&amp;friendship_status_changed=true
</code></pre></div></div> <ul> <li>Lấy access token: Để lấy accesstoken, hãy tạo một yêu cầu POST HTTP với mã ủy quyền. Khi bạn có mã thông báo truy cập, bạn có thể sử dụng nó để thực hiện các cuộc gọi API. Mã thông báo truy cập được phát hành tại điểm cuối sau. <ul> <li>Request <blockquote> <p>POST https://api.line.me/oauth2/v2.1/token</p> </blockquote> </li> <li>Request header: | Request header | Mô tả | | ————- |:————-:| | Content-Type | application/x-www-form-urlencoded |</li> <li> <p>Request body</p> <table> <thead> <tr> <th>Parameters</th> <th style="text-align: center">Type</th> <th style="text-align: right">Required</th> <th style="text-align: right">Description</th> </tr> </thead> <tbody> <tr> <td>grant_type</td> <td style="text-align: center">String</td> <td style="text-align: right">Required</td> <td style="text-align: right">authorization_code.</td> </tr> <tr> <td>code</td> <td style="text-align: center">String</td> <td style="text-align: right">Required</td> <td style="text-align: right">Authorization code</td> </tr> <tr> <td>redirect_uri</td> <td style="text-align: center">String</td> <td style="text-align: right">Required</td> <td style="text-align: right">Callback URL</td> </tr> <tr> <td>client_id</td> <td style="text-align: center">String</td> <td style="text-align: right">Required</td> <td style="text-align: right">Channel ID. Found in the console.</td> </tr> <tr> <td>client_secret</td> <td style="text-align: center">String</td> <td style="text-align: right">Required</td> <td style="text-align: right">Channel secret. Found in the console.</td> </tr> </tbody> </table> </li> </ul> </li> <li>Response: Sau khi request, nếu thông tin truyền lên valid, Line sẽ trả về <code class="language-plaintext highlighter-rouge">access_token</code> và một số thông tin đi kèm.</li> <li>Chúng ta sẽ sử dụng accesstoken đó để request lên <a href="https://developers.line.biz/en/docs/line-login/web/integrate-line-login/#use-endpoint">LINE social enpoint</a> để sử dụng các thông tin mà Line cung cấp.</li> </ul> <h4 id="22-nhắn-tin-sử-dụng-line-channel">2.2. Nhắn tin sử dụng line channel</h4> <p>Để sử dụng tính năng nhắn tin Line, bạn cần phải tạo một channel để nhắn tin tại: <a href="https://developers.line.biz/console/">Line console</a></p> <p>Các lưu ý:</p> <ul> <li>Sử dụng channel access token: Accesstoken là token tồn tại lâu dài phải được đặt trong tiêu đề ủy quyền khi thực hiện các cuộc gọi API. Bạn có thể phát hành lại mã thông báo truy cập kênh bất cứ lúc nào thông qua bảng điều khiển.</li> <li>Để sử dụng một access token, click vào <code class="language-plaintext highlighter-rouge">issue</code> bên dưới phần <code class="language-plaintext highlighter-rouge">**Channel access token (long-lived)**</code> trong tab <code class="language-plaintext highlighter-rouge">Messaging API</code></li> <li>Mặc định, BOT không thể nhắn tin cho người dùng mà chưa kết bạn hoặc chưa từng tuơng tác với người dùng. Vì thế bạn cần chắc chắn là bot channel của mình đã kết bạn với người dùng. Có nhiều cách như trên trang chủ <a href="https://developers.line.biz/en/docs/messaging-api/building-bot/#sending-reply-messages">LINE</a> đã cung cấp. Trong phần này mình sẽ hướng dẫn bạn sử dụng tính năng <code class="language-plaintext highlighter-rouge">push_message</code> <em>Chú ý: để có thể hiển thị tính năng kết bạn sau khi người dùng chấp nhận ủy quyền thông tin của Line, bạn cần liên kết Line bot messaging với Line login: Trong tab <strong>## LINE Login settings</strong> &gt; <strong>### General settings</strong> &gt; <strong>Linked OA</strong> chọn app liên kết là Line bot messaging bạn vừa tạo.</em></li> </ul> <p>Hướng dẫn sử dụng tính năng <code class="language-plaintext highlighter-rouge">push_message</code>:</p> <ul> <li> <p>HTTP request POST https://api.line.me/v2/bot/message/push</p> </li> <li> <p>Request headers</p> <table> <thead> <tr> <th>Request header</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>Content-Type</td> <td>application/json</td> </tr> <tr> <td>Authorization</td> <td>Bearer {channel access token}</td> </tr> </tbody> </table> </li> <li> <p>Request body</p> <table> <thead> <tr> <th>Property</th> <th>Type</th> <th>Required Description</th> <th> </th> </tr> </thead> <tbody> <tr> <td>to</td> <td>String</td> <td>Required</td> <td>ID của người nhận mục tiêu. Sử dụng giá trị userId, groupId hoặc roomId được trả về trong một đối tượng sự kiện webhook. Không sử dụng ID LINE được tìm thấy trên LINE.</td> </tr> <tr> <td>messages</td> <td>Array của các đối tượng tin nhắn</td> <td>Required Messages, Tối đa: 5</td> <td> </td> </tr> <tr> <td>notificationDisabled</td> <td>Boolean</td> <td>Optional</td> <td> </td> </tr> </tbody> </table> </li> </ul> <p>Ví dụ khi thực hiện request sử dụng <code class="language-plaintext highlighter-rouge">curl</code> :</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -v -X POST https://api.line.me/v2/bot/message/push \
-H 'Content-Type: application/json' \
-H 'Authorization: Bearer {channel access token}' \
-d '{
    "to": "U4af4980629...",
    "messages":[
        {
            "type":"text",
            "text":"Hello, world1"
        },
        {
            "type":"text",
            "text":"Hello, world2"
        }
    ]
}'
</code></pre></div></div> <br /><!-- Load Facebook SDK for JavaScript --> <div id="fb-root"></div> <script> (function(d, s, id) { var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.0"; fjs.parentNode.insertBefore(js, fjs); })(document, "script", "facebook-jssdk"); </script> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8" ></script> <div class="share-page"> <p class="share-text">Share this on &rarr;</p> <a href="https://twitter.com/share?ref_src=twsrc%5Etfw" class="twitter-share-button" data-size="large" data-show-count="false" style="margin-top:5px;" >Tweet</a > <a class="fb-share-button" data-href="/technical/2020/01/06/login-and-messaging-with-line/" data-size="large" data-layout="button" >Share</a> </div><!-- Author box --> <div class="card"> <div class="card-header"> About Hung Nguyen </div> <div class="card-body"> <div class="row"> <div class="col-md-4"> <img class="author-profile-img" src="/assets/img/authors/hungnv950.jpeg" alt="Hung Nguyen" /> </div> <div class="col-md-6"> <p class="author_bio">Hi I a Hung, a Web Developer and Project manager.</p> <p>Email : hungnv950@gmail.com</p> <p>Website : http://hungnv950.github.io</p> <p class="profile-links"> <a class="social-link" href="https://github.com/hungnv950" target="_blank"><i class="fab fa-github fa-fw"></i></a> <a class="social-link" href="https://www.linkedin.com/in/hungnv950" target="_blank"><i class="fab fa-linkedin fa-fw"></i></a> <a class="social-link" href="https://www.youtube.com/channel/UCSfLBFFfNU9r6ihfei6VeJw" target="_blank"><i class="fab fa-youtube fa-fw"></i></a> <a class="social-link" href="https://www.facebook.com/hungnv950" target="_blank"><i class="fab fa-facebook fa-fw"></i></a> <a class="social-link" href="https://www.twitter.com/hungnv950" target="_blank"><i class="fab fa-twitter fa-fw"></i></a> <a class="social-link" href="https://behance.com/hungnv950" target="_blank"><i class="fab fa-behance fa-fw"></i></a> <a class="social-link" href="https://instagram.com/hungnv950" target="_blank"><i class="fab fa-instagram fa-fw"></i></a> <a class="social-link" href="https://medium.com/hungnv950" target="_blank"><i class="fab fa-medium fa-fw"></i></a> <a class="social-link" href="https://telegram.com/hungnv950" target="_blank"><i class="fab fa-telegram fa-fw"></i></a> <a class="social-link" href="https://dribbble.com/hungnv950" target="_blank"><i class="fab fa-dribbble fa-fw"></i></a> <a class="social-link" href="https://flickr.com/hungnv950" target="_blank"><i class="fab fa-flickr fa-fw"></i></a> </p> </div> </div> </div> </div> </div><div class="comments"><!-- Hyvor Comments. For more info visit https://talk.hyvor.com --> <div id="hyvor-talk-view"></div> <script type="text/javascript"> var HYVOR_TALK_WEBSITE = '3698'; var HYVOR_TALK_CONFIG = { url: '/technical/2020/01/06/login-and-messaging-with-line/', id: '/technical/2020/01/06/login-and-messaging-with-line', palette: { accent: "#EB8E3F", accentText: "#080808", footerHeader: "#171616", footerHeaderText: "#656363", box: "#3A3A38", boxText: "#E0E0E0", boxLightText: "#AAAAAA", backgroundText: "#E0E0E0" } }; </script> <script async type="text/javascript" src="//talk.hyvor.com/web-api/embed"></script> </div><!-- Incomment incase you want to use Disqus <div id="disqus_thread"></div> --> </article> <script> var disqus_config = function () { this.page.url = "/technical/2020/01/06/login-and-messaging-with-line/"; /* Replace PAGE_URL with your page's canonical URL variable */ this.page.identifier = "/technical/2020/01/06/login-and-messaging-with-line"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */ }; (function () { /* DON'T EDIT BELOW THIS LINE */ var d = document, s = d.createElement('script'); s.src = 'https://.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a> </noscript></div> </div> <div class="row"> <div class="col-md-4"> <div class="card"> <div class="card-header">About Hung Nguyen</div> <div class="card-body"> <p class="author_bio">Hi, my name is Hung Nguyen</p><!-- Place this tag where you want the github button to render. --> <a class="github-button" href="https://github.com/Hungnv950/hungnv950.github.io" data-color-scheme="no-preference: dark; light: dark; dark: dark;" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star sujaykundu777/devlopr-jekyll on GitHub">Star</a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Categories</div> <div class="card-body text-dark"> <div id="#technical"></div> <li class="tag-head"> <a href="/blog/categories/technical">Technical</a> </li> <a name="technical"></a> <div id="#life"></div> <li class="tag-head"> <a href="/blog/categories/life">Life</a> </li> <a name="life"></a> </div> </div> </div> <div class="col-md-4"> <div class="card"> <div class="card-header">Useful Links</div> <div class="card-body text-dark"> <li> <a href="/">Home</a> </li> <li> <a href="/blog">Blog</a> </li> <li> <a href="/gallery">Gallery</a> </li> <li> <a href="/about">About</a> </li> <li> <a href="/contact">Contact</a> </li> </div> </div> </div> </div> </div> <div class="col-lg-12" id="newsletter_footer"> </div><footer> <p> Powered by<a href="https://github.com/Hungnv950/hungnv950.github.io"> devlopr jekyll</a>.Hosted at <a href="https://pages.github.com">Github</a>. Subscribe via <a href=" /feed.xml ">RSS</a> </p> </footer> <script> var options = { classname: 'my-class', id: 'my-id' }; var nanobar = new Nanobar( options ); nanobar.go( 30 ); nanobar.go( 76 ); nanobar.go(100); </script> <!-- <div hidden id="snipcart" data-api-key="Y2I1NTAyNWYtMTNkMy00ODg0LWE4NDItNTZhYzUxNzJkZTI5NjM3MDI4NTUzNzYyMjQ4NzU0"></div> <script src="https://cdn.snipcart.com/themes/v3.0.0-beta.3/default/snipcart.js" defer></script> --> <script src="/assets/js/mode-switcher.js"></script> <script> if (window.netlifyIdentity) { window.netlifyIdentity.on("init", user => { if (!user) { window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; }); } }); } </script> </body> </html>
